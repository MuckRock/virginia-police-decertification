View(certified_directory)
present <- read.csv(here("data", "processed","clean_for_analysis", "present.csv")) %>%
select(-X, -...1)
prior <- read.csv(here("data", "processed","clean_for_analysis", "prior.csv")) %>%
select(-X, -...1)
reinstated <- read.csv(here("data", "processed","clean_for_analysis", "reinstated.csv")) %>%
select(-X, -...1)
certified_directory <- read.csv(here("data", "processed","clean_for_analysis", "certified_directory.csv")) %>%
select(-X)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment))
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment))
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num)
View(present_agency_totals)
View(present_agency_totals_cert)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) #%>%
View(present_agency_totals_cert)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100), digits = 0)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 0))
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2))
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2))
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(num_decerts, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2))
# what to do about NAs?
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2))
# what to do about NAs?
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min"))
# what to do about NAs?
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min"))
# what to do about NAs?
library(tidyverse)
library(here)
library(janitor)
library(ggplot2)
library(plotly)
library(DT)
library(tidyverse)
library(here)
library(janitor)
library(ggplot2)
library(plotly)
library(DT)
present <- read.csv(here("data", "processed","clean_for_analysis", "present.csv")) %>%
select(-X, -...1)
prior <- read.csv(here("data", "processed","clean_for_analysis", "prior.csv")) %>%
select(-X, -...1)
reinstated <- read.csv(here("data", "processed","clean_for_analysis", "reinstated.csv")) %>%
select(-X, -...1)
certified_directory <- read.csv(here("data", "processed","clean_for_analysis", "certified_directory.csv")) %>%
select(-X)
present_agency_totals <- present %>%
group_by(agency_name) %>%
summarize(num = n())
pres_hist <- ggplot(present_agency_totals, aes(x=num)) +
geom_histogram()
ggplotly(pres_hist)
#| output: true
ggplotly(pres_hist)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min"))
# what to do about NAs?
View(present_agency_totals)
View(present_agency_totals_cert)
View(certified_directory)
View(certified_directory)
View(certified_directory)
write.csv(present_agency_totals_cert, "test.csv")
write.csv(present_agency_totals_cert, "test.csv")
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min")) %>%
arrange(desc(value)) %>%  # Sort by value descending
slice_head(n = 10)
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min")) %>%
arrange(desc(num_decerts)) %>%  # Sort by value descending
slice_head(n = 10)
write.csv(present_agency_totals_cert, "test.csv")
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min"))
View(present)
library(lubridate)
agency_year <- present %>%
mutate(year = year(fixed_date))
View(agency_year)
agency_year <- present %>%
mutate(year = year(fixed_date)) %>%
group_by(agency_name, year) %>%
summarize(num = n())
agency_year <- present %>%
mutate(year = year(fixed_date)) %>%
group_by(agency_name, year) %>%
summarize(num = n()) %>%
pivot_wider(names_from = year, values_from = num)
agency_year <- present %>%
mutate(year = year(fixed_date)) %>%
group_by(year) %>%
summarize(num = n())
by_year <- present %>%
mutate(year = year(fixed_date)) %>%
group_by(year) %>%
summarize(num = n())
View(by_year)
View(prior)
View(prior)
View(prior)
View(reinstated)
View(prior)
by_year_prior <- prior %>%
mutate(year = year(fixed_date)) %>%
group_by(year) %>%
summarize(num = n())
View(prior)
View(by_year_prior)
View(by_year)
agency_year_present <- prior %>%
mutate(year = year(fixed_date)) %>%
group_by(agency_name, year) %>%
summarize(num = n()) %>%
pivot_wider(names_from = year, values_from = num)
agency_year_present <- present %>%
mutate(year = year(fixed_date)) %>%
group_by(agency_name, year) %>%
summarize(num = n()) %>%
pivot_wider(names_from = year, values_from = num)
agency_year_prior <- prior %>%
mutate(year = year(fixed_date)) %>%
group_by(agency_name, year) %>%
summarize(num = n()) %>%
pivot_wider(names_from = year, values_from = num)
View(agency_year_prior)
prior_agency_totals <- prior %>%
group_by(agency_name) %>%
summarize(num = n())
View(prior_agency_totals)
View(agency_year_present)
by_year_present <- present %>%
mutate(year = year(fixed_date)) %>%
group_by(year) %>%
summarize(num = n())
by_year_prior <- prior %>%
mutate(year = year(fixed_date)) %>%
group_by(year) %>%
summarize(num = n())
View(by_year_present)
View(agency_year_prior)
View(agency_year_present)
View(present)
type <- present %>%
group_by(reason) %>%
summarize(n())
View(type)
citation <- present %>%
mutate(citation = str_extract(reason, ".*?(?=\\s*-\\s*)"))
View(citation)
citation <- present %>%
mutate(citation = str_extract(reason, "^[^-]+-[^-]+"))
citation <- present %>%
mutate(citation = str_extract(reason, "^[^-]+-[^-]+")) %>%
group_by(citation) %>%
summarize(n())
View(citation)
type_top_three <-  present %>%
filter(agency_name %in% c("Virgina State Police", "Chesapeake Police Department"," Henrico County Sheriff's Office")) %>%
group_by(reason) %>%
summarize(n())
View(type_top_three)
type_top_three <-  present %>%
filter(agency_name %in% c("Virgina State Police", "Chesapeake Police Department"," Henrico County Sheriff's Office")) #%>%
View(type_top_three)
View(present_agency_totals_cert)
type_top_three <-  present %>%
filter(agency_name %in% c("Virginia State Police", "Chesapeake Police Department", "Henrico County Sheriff's Office")) #%>%
View(type_top_three)
type_top_three <-  present %>%
filter(agency_name %in% c("Virginia State Police", "Chesapeake Police Department", "Henrico County Sheriff's Office")) %>%
group_by(reason) %>%
summarize(n())
type_top_three <-  present %>%
filter(agency_name %in% c("Virginia State Police", "Chesapeake Police Department", "Henrico County Sheriff's Office")) %>%
group_by(agency, reason) %>%
summarize(n())
type_top_three <-  present %>%
mutate(year = year(fixed_date)) %>%
filter(agency_name %in% c("Virginia State Police", "Chesapeake Police Department", "Henrico County Sheriff's Office")) %>%
group_by(agency, year, reason) %>%
summarize(n())
type_top_three <-  present %>%
mutate(year = year(fixed_date)) %>%
filter(agency_name %in% c("Virginia State Police", "Chesapeake Police Department", "Henrico County Sheriff's Office")) %>%
group_by(agency, reason) %>%
summarize(n())
View(reinstated)
# By agency
reinstated_agency <- reinstated %>%
group_by(agency_name) %>%
summarize(n())
View(reinstated_agency)
# By year
reinstated_agency <- reinstated %>%
mutate(year = year(fixed_date)) %>%
group_by(agency_name) %>%
summarize(n())
# By year
reinstated_agency <- reinstated %>%
mutate(year = year(recert_date)) %>%
group_by(agency_name) %>%
summarize(n())
# By year
reinstated_agency <- reinstated %>%
mutate(year = year(recert_date)) %>%
group_by(year) %>%
summarize(n())
View(type)
View(prior)
library(tidyverse)
library(here)
library(janitor)
library(ggplot2)
library(plotly)
library(DT)
library(lubridate)
present <- read.csv(here("data", "processed","clean_for_analysis", "present.csv")) %>%
select(-X, -...1)
prior <- read.csv(here("data", "processed","clean_for_analysis", "prior.csv")) %>%
select(-X, -...1)
reinstated <- read.csv(here("data", "processed","clean_for_analysis", "reinstated.csv")) %>%
select(-X, -...1)
certified_directory <- read.csv(here("data", "processed","clean_for_analysis", "certified_directory.csv")) %>%
select(-X)
by_year_present <- present %>%
mutate(year = year(fixed_date)) %>%
group_by(year) %>%
summarize(num = n())
by_year_prior <- prior %>%
mutate(year = year(fixed_date)) %>%
group_by(year) %>%
summarize(num = n())
View(by_year_prior)
View(by_year_present)
merge_years <- merge(by_year_present, by_year_prior)
View(by_year_present)
View(by_year_prior)
merge_years <- rbind(by_year_present, by_year_prior)
View(merge_years)
View(by_year_prior)
write.csv(merge_years, ".../data/procesed/for_datawrapper_vis/all_years.csv")
write.csv(merge_years, ".../data/processed/for_datawrapper_vis/all_years.csv")
write.csv(merge_years, "/data/processed/for_datawrapper_vis/all_years.csv")
write.csv(merge_years, "data/processed/for_datawrapper_vis/all_years.csv")
getwd()
write.csv(merge_years, "...data/processed/for_datawrapper_vis/all_years.csv")
write.csv(merge_years, "..data/processed/for_datawrapper_vis/all_years.csv")
write.csv(merge_years, "../data/processed/for_datawrapper_vis/all_years.csv")
merge_years <- rbind(by_year_present, by_year_prior) %>%
arrange(desc(year))
write.csv(merge_years, "../data/processed/for_datawrapper_vis/all_years.csv")
View(present)
no_decertifications <- present %>%
distinct(agency_name)
View(no_decertifications)
View(certified_directory)
View(certified_directory)
no_decertifications <- present %>%
distinct(agency_name) %>%
anti_join(certified_directory, join_by(agency_name == place_of_employment))
View(no_decertifications)
no_decertifications <- certified_directory %>%
anti_join(present, join_by(place_of_employment == agency_name))
View(no_decertifications)
View(present)
no_decertifications <- certified_directory %>%
anti_join(present, join_by(place_of_employment == agency_name)) %>%
select(agency_name = place_of_employment)
no_decertifications <- certified_directory %>%
anti_join(present, join_by(place_of_employment == agency_name)) %>%
select(agency_name = place_of_employment) %>%
mutate(decerts == 0)
no_decertifications <- certified_directory %>%
anti_join(present, join_by(place_of_employment == agency_name)) %>%
select(agency_name = place_of_employment) %>%
mutate(decerts = 0)
present_agency_totals <- present %>%
group_by(agency_name) %>%
summarize(decerts = n())
all_agencies <- rbind(no_decertifications, present_agency_totals)
View(all_agencies)
View(all_agencies)
pres_hist <- ggplot(present_agency_totals, aes(x=num)) +
geom_histogram()
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram()
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(color = "#000000", fill = "#0099F8")
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(color = "#000000", fill = "#fa8c00")
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(color = "#000000", fill = "#fa8c00") +
theme_void()
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(color = "#000000", fill = "#fa8c00") +
theme_classic()
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(color = "#000000", fill = "#fa8c00") +
labs(
title = "Histogram of Life Expectancy in Europe",
subtitle = "Made by Appsilon",
caption = "Source: Gapminder dataset",
x = "Life expectancy",
y = "Count") +
theme_classic()
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(color = "#000000", fill = "#fa8c00") +
labs(
title = "Most agencies have decertified just a few officers at most",
x = "Number of decertifications",
y = "Number of agencies") +
theme_classic()
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(fill = "#fa8c00") +
labs(
title = "Most agencies have decertified just a few officers at most",
x = "Number of decertifications",
y = "Number of agencies") +
theme_classic()
ggplotly(pres_hist)
pres_hist <- ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(fill = "#fa8c00", binwidth = 1, boundary = 0) +
labs(
title = "Most agencies have decertified just a few officers at most",
x = "Number of decertifications",
y = "Number of agencies") +
theme_classic()
ggplotly(pres_hist)
ggplot(present_agency_totals, aes(x=decerts)) +
geom_histogram(fill = "#fa8c00", binwidth = 1, boundary = 0) +
labs(
title = "Most agencies have decertified just a few officers at most",
x = "Number of decertifications",
y = "Number of agencies") +
theme_classic()
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = num, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min"))
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = decerts, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min"))
# what to do about NAs?
present_agency_totals_cert <- present_agency_totals %>%
left_join(certified_directory, join_by(agency_name == place_of_employment)) %>%
select(agency_name, num_decerts = decerts, certified_officers_jailors) %>%
mutate(percentile_decert = round(rank(num_decerts, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(size_rank = rank(-certified_officers_jailors, ties.method = "min")) %>%
mutate(percentile_size = round(rank(certified_officers_jailors, ties.method = "min") / nrow(present_agency_totals) *100, digits = 2)) %>%
mutate(decert_rank = rank(-num_decerts, ties.method = "min"))
# what to do about NAs?
View(present_agency_totals_cert)
type <- present %>%
group_by(reason) %>%
summarize(n())
View(type)
type <- present %>%
group_by(reason) %>%
summarize(reason = n())
type <- present %>%
group_by(reason) %>%
summarize(decerts = n())
#| output: true
datatable(type, filter = 'top', class = 'cell-border stripe order-column', extensions = 'Buttons',
autoHideNavigation = getOption("DT.autoHideNavigation", NULL),
options = list(
paging = TRUE,
searching = TRUE,
fixedColumns = TRUE,
autoWidth = TRUE,
ordering = TRUE,
dom = 'tB',
buttons = c('copy', 'csv', 'excel')
))
#| output: true
datatable(type, filter = 'top', class = 'cell-border stripe order-column', extensions = 'Buttons',
options = list(
paging = TRUE,
searching = TRUE,
fixedColumns = TRUE,
autoWidth = TRUE,
ordering = TRUE,
dom = 'tB',
buttons = c('copy', 'csv', 'excel'),
pageLength = 10,        # Number of rows per pag
lengthMenu = c(5, 10, 25, 50),  # Dropdown options for rows per page
paging = TRUE
))
#| output: true
datatable(type, filter = 'top', class = 'cell-border stripe order-column', extensions = 'Buttons',
options = list(
paging = TRUE,
pageLength = 10,
lengthMenu = c(5, 10, 25, 50),
searching = TRUE,
fixedColumns = TRUE,
autoWidth = TRUE,
ordering = TRUE,
dom = 'tB',
buttons = c('copy', 'csv', 'excel')
))
# By agency
# No big trends in agencies, all just one except for Fairfax and Virginia State Police
reinstated_agency <- reinstated %>%
group_by(agency_name) %>%
summarize(n())
# By year
reinstated_year <- reinstated %>%
mutate(year = year(recert_date)) %>%
group_by(year) %>%
summarize(n())
View(reinstated_agency)
View(reinstated_year)
#| output: true
datatable(reinstated_year, filter = 'top', class = 'cell-border stripe order-column', extensions = 'Buttons',
rownames = FALSE,
options = list(
paging = TRUE,
pageLength = 10,
lengthMenu = c(5, 10, 25, 50),
searching = TRUE,
fixedColumns = TRUE,
autoWidth = TRUE,
ordering = TRUE,
dom = 'tB',
buttons = c('copy', 'csv', 'excel')
))
