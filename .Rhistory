library(tidyverse)
library(janitor)
library(here)
library(readxl)
agency_directory <- read_excel(here("data", "Criminal_Justice_Agency_Directory.xlsx"))
View(agency_directory)
certified_officers <- read_excel(here("data", "Number_of_Certified_Officers_Per_Agency.xlsx"))
View(certified_officers)
decert_sheets <- read_excel(here("data", "DCJ_Decertification_List.xlsx"))
decert_sheets <- read_excel(here("data", "DCJS_Decertification_List.xlsx"))
decert_sheets <- read_excel(here("data", "DCJS_Decertification_List.xlsx"))
excel_sheets(decert_sheets)
View(decert_sheets)
decert_sheets <- excel_sheets(here("data", "DCJS_Decertification_List.xlsx"))
one_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 1)
View(one_df)
two_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 2)
three_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 3)
four_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 4)
library(tidyverse)
library(janitor)
library(here)
library(readxl)
agency_directory <- read_excel(here("data", "Criminal_Justice_Agency_Directory.xlsx"))
certified_officers <- read_excel(here("data", "Number_of_Certified_Officers_Per_Agency.xlsx"))
decert_sheets <- excel_sheets(here("data", "DCJS_Decertification_List.xlsx"))
one_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 1)
two_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 2)
View(certified_officers)
View(certified_officers)
three_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 3)
four_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 4)
View(one_df)
View(certified_officers)
View(one_df)
View(agency_directory)
library(tidyverse)
library(janitor)
library(here)
library(readxl)
agency_directory <- read_excel(here("data", "Criminal_Justice_Agency_Directory.xlsx"))
certified_officers <- read_excel(here("data", "Number_of_Certified_Officers_Per_Agency.xlsx"))
decert_sheets <- excel_sheets(here("data", "DCJS_Decertification_List.xlsx"))
one_df <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 1)
View(one_df)
sheet_one <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 1)
View(sheet_one)
decerts <- sheet_one %>%
slice(-1)
View(decerts)
View(sheet_one)
View(decerts)
sheet_one <- read_excel(here("data", "DCJS_Decertification_List.xlsx"), sheet = 1)
decerts <- sheet_one %>%
row_to_names(row_number = 2)
View(decerts)
decerts <- sheet_one %>%
row_to_names(row_number = 2) %>%
filter_all(is.na())
decerts <- sheet_one %>%
row_to_names(row_number = 2) %>%
filter(if_any(everything(), is.na))
View(decerts)
decerts <- sheet_one %>%
row_to_names(row_number = 2)
decerts <- sheet_one %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
filter(if_any(first_name, is.na))
decerts <- sheet_one %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(if_any(first_name, !is.na))
decerts <- sheet_one %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na))
dupe_check <- decerts %>%
group_by(first_name, last_name) %>%
summarize(total = n())
View(dupe_check)
dupe_check <- decerts %>%
group_by(first_name, middle_initial, last_name) %>%
summarize(total = n())
View(dupe_check)
agency_totals <- decerts %>%
group_by(agency) %>%
summmarize(total = n())
agency_totals <- decerts %>%
group_by(agency) %>%
summarize(total = n())
View(agency_totals)
View(agency_directory)
agency_directory <- read_excel(here("data", "Criminal_Justice_Agency_Directory.xlsx")) %>%
clean_names()
certified_officers <- read_excel(here("data", "Number_of_Certified_Officers_Per_Agency.xlsx")) %>%
clean_names()
View(certified_officers)
decert_rate <- agency_totals %>%
left_join(certified_officers, join_by(agency == place_of_employment))
agency_rate <- agency_totals %>%
left_join(certified_officers, join_by(agency == place_of_employment))
View(agency_rate)
agency_rate <- agency_totals %>%
inner_join(certified_officers, join_by(agency == place_of_employment))
View(agency_rate)
# First, let's try decerts to certified officers
# Ok so probablem is that only 70 of 126 agencys from decerts matched a name in the ceritified officers table
agency_rate <- agency_totals %>%
left_join(certified_officers, join_by(agency == place_of_employment))
View(agency_rate)
View(certified_officers)
View(certified_officers)
# The easy way first: do all certified officer agencies have a match in the agency directory?
certified_directory_join <- certified_officers %>%
inner_join(agency_directory, join_by(place_of_employment == agency_name))
View(certified_directory_join)
# The easy way first: do all certified officer agencies have a match in the agency directory?
certified_directory_join <- certified_officers %>%
left_join(agency_directory, join_by(place_of_employment == agency_name))
View(certified_directory_join)
# The easy way first: do all certified officer agencies have a match in the agency directory?
certified_directory_join <- certified_officers %>%
anti_join(agency_directory, join_by(place_of_employment == agency_name))
# The easy way first: do all certified officer agencies have a match in the agency directory?
# Well good, all certified officer agencies have a join in the directory, except one: Emory & Henry University Police Department
certified_directory_join <- certified_officers %>%
inner_join(agency_directory, join_by(place_of_employment == agency_name))
# First, let's try decerts to certified officers
# Ok so problem is that only 70 of 126 agencys from decerts matched a name in the certified officers table
agency_rate <- agency_totals %>%
anti_join(certified_officers, join_by(agency == place_of_employment))
View(agency_rate)
# First, let's try decerts to certified officers
# Ok so problem is that only 70 of 126 agencys from decerts matched a name in the certified officers table
missing_agencies <- agency_totals %>%
anti_join(certified_officers, join_by(agency == place_of_employment))
View(missing_agencies)
View(agency_totals)
library(tidyverse)
library(janitor)
library(here)
library(readxl)
agency_directory <- read_excel(here("data", "raw", "Criminal_Justice_Agency_Directory.xlsx")) %>%
clean_names()
certified_officers <- read_excel(here("data", "raw", "Number_of_Certified_Officers_Per_Agency.xlsx")) %>%
clean_names()
decert_sheets <- excel_sheets(here("data","raw", "DCJS_Decertification_List.xlsx"))
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na))
crosswalk_corrections <- read_csv(here("data", "manual", "crosswalk_correction.csv"))
crosswalk_corrections <- read_csv(here("data", "manual", "crosswalk_corrections.csv"))
View(crosswalk_corrections)
View(decertifications)
decerts_corrected <- decertifications %>%
inner_join(crosswalk_corrections, join_by(agency))
decerts_corrected <- decertifications %>%
left_join(crosswalk_corrections, join_by(agency))
View(decerts_corrected)
decerts_corrected <- decertifications %>%
left_join(crosswalk_corrections, join_by(agency)) %>%
mutate(agency_name = case_when(is.na(crosswalk_correction) ~ agency, .default = crosswalk_correction))
View(decerts_corrected)
decert_directory_join <- decerts_corrected %>%
inner_join(agency_directory, join_by(agency_name))
View(decert_directory_join)
View(certified_officers)
decert_directory_certs_join <- decerts_corrected %>%
inner_join(agency_directory, join_by(agency_name)) %>%
left_join(certified_officers, join_by(agency_name == place_of_employment))
View(decert_directory_join)
decert_directory_certs_join <- decerts_corrected %>%
inner_join(agency_directory, join_by(agency_name))
decert_directory_certs_join <- decerts_corrected
View(decert_directory_join)
decert_directory_certs_join <- decerts_corrected
View(decert_directory_certs_join)
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n())
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
inner_join(certified_officers, join_by(agency_name == place_of_employment))
View(decertifications)
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) #%>%
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
inner_join(certified_officers, join_by(agency_name == place_of_employment))
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
inner_join(certified_officers, join_by(agency_name == place_of_employment)) %>%
inner_join(agency_directory, join_by(agency_name))
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
inner_join(certified_officers, join_by(agency_name == place_of_employment)) %>%
left_join(agency_directory, join_by(agency_name))
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
left_join(certified_officers, join_by(agency_name == place_of_employment))
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
left_join(certified_officers, join_by(agency_name == place_of_employment)) %>%
left_join(agency_directory, join_by(agency_name))
install.packages("tidygeocoder")
library(tidygeocoder)
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
left_join(certified_officers, join_by(agency_name == place_of_employment)) %>%
left_join(agency_directory, join_by(agency_name)) %>%
mutate(full_address = paste(physical_address, ",", physical_city, ",", physical_state, physical_zip))
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
left_join(certified_officers, join_by(agency_name == place_of_employment)) %>%
left_join(agency_directory, join_by(agency_name)) %>%
mutate(full_address = paste(physical_street_address, ",", physical_city, ",", physical_state, physical_zip))
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
left_join(certified_officers, join_by(agency_name == place_of_employment)) %>%
left_join(agency_directory, join_by(agency_name)) %>%
mutate(full_address = paste0(physical_street_address, ",", physical_city, ",", physical_state, physical_zip))
# Check numbers later, but looks like we condensed from 126 total to 106 with fixed agency names
decert_directory_certs_join <- decerts_corrected %>%
group_by(agency_name) %>%
summarize(decerts = n()) %>%
left_join(certified_officers, join_by(agency_name == place_of_employment)) %>%
left_join(agency_directory, join_by(agency_name)) %>%
mutate(full_address = paste0(physical_street_address, ", ", physical_city, ", ", physical_state," ", physical_zip))
geocoded_df <- decert_directory_certs_join %>%
geocode(full_address, method = 'osm', lat = latitude , long = longitude)
View(geocoded_df)
library(ggmap)
register_google(key = "AIzaSyDumzJk6Xv2r-WDHs6sGTef-tqsj2H-VnA", write = TRUE)
geocoded_df <- decert_directory_certs_join %>%
mutate_geocode(full_address, location = Geo_Address, output = "latlona")
geocoded_df <- decert_directory_certs_join %>%
mutate_geocode(location = full_address, output = "latlona")
View(geocoded_df)
dw_export <- geocoded_df %>%
mutate(rate = decerts/certified_officers_jailors)
View(dw_export)
write.csv(dw_export, "dw_test.csv")
View(decertifications)
View(decerts_corrected)
write.csv(decerts_corrected, "test_decerts_corrected.csv")
# Read data
crosswalk_corrections <- read_csv(here("data", "manual", "crosswalk_corrections.csv"))
library(tidyverse)
library(here)
library(janitor)
# Read data
crosswalk_corrections <- read_csv(here("data", "manual", "crosswalk_corrections.csv"))
agency_directory <- read_excel(here("data", "raw", "Criminal_Justice_Agency_Directory.xlsx")) %>%
clean_names()
library(readxl)
# Read data
crosswalk_corrections <- read_csv(here("data", "manual", "crosswalk_corrections.csv"))
agency_directory <- read_excel(here("data", "raw", "Criminal_Justice_Agency_Directory.xlsx")) %>%
clean_names()
certified_officers <- read_excel(here("data", "raw", "Number_of_Certified_Officers_Per_Agency.xlsx")) %>%
clean_names()
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na))
View(decertifications)
decerts_corrected <- decertifications %>%
left_join(crosswalk_corrections, join_by(agency)) %>%
mutate(agency_name = case_when(is.na(crosswalk_correction) ~ agency, .default = crosswalk_correction))
View(decerts_corrected)
View(decertifications)
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = as.Date(decert_date, origin = "1899-12-30"))
View(decertifications)
glimpse(decertifications)
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = as.Date(decert_date, origin = "1899-12-30"))
View(decertifications)
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = case_when(decert_date == "10/04/0222" ~ "10/04/2022",
.default = as.Date(decert_date, origin = "1899-12-30")))
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = case_when(decert_date == "10/04/0222" ~ "10/04/2022",
.default = decert_date))
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = case_when(decert_date == "10/04/0222" ~ "10/04/2022",
.default = as_date(decert_date)))
library(lubridate)
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = case_when(decert_date == "10/04/0222" ~ "10/04/2022",
.default = as_date(decert_date)))
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = case_when(
decert_date == "10/04/0222" ~ as_date("10/04/2022", format = "%m/%d/%Y"),
.default = as_date(decert_date)
))
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = case_when(
decert_date == "10/04/0222" ~ as.Date("10/04/2022", format = "%m/%d/%Y"),
.default = as.Date(decert_date, origin = "1899-12-30")))
decertifications <- read_excel(here("data", "raw", "DCJS_Decertification_List.xlsx"), sheet = 1) %>%
row_to_names(row_number = 2) %>%
clean_names() %>%
# Get rid of placeholder rows for years in Excel styling
filter(!if_any(first_name, is.na)) %>%
mutate(fixed_date = case_when(
decert_date == "10/04/0222" ~ as.Date("10/04/2022", format = "%m/%d/%Y"),
.default = as.Date(as.numeric(decert_date), origin = "1899-12-30")))
library(tidyverse)
library(here)
library(janitor)
library(readxl)
# Read in data with clean dates
present <- read_csv(here("data", "processed", "present.csv"))
prior <- read_csv(here("data", "processed", "prior.csv"))
reinstated <- read_csv(here("data", "processed", "reinstated.csv"))
# Read tables with general info for each agency
agency_directory <- read_excel(here("data", "raw", "Criminal_Justice_Agency_Directory.xlsx")) %>%
clean_names()
certified_officers <- read_excel(here("data", "raw", "Number_of_Certified_Officers_Per_Agency.xlsx")) %>%
clean_names()
### JOIN AGENCY DIRECTORY AND CERTIFIED OFFICER TABLES ###
certified_directory_join <- certified_officers %>%
inner_join(agency_directory, join_by(place_of_employment == agency_name))
View(certified_directory_join)
### JOIN AGENCY DIRECTORY AND CERTIFIED OFFICER TABLES ###
certified_directory_join <- certified_officers %>%
left_join(agency_directory, join_by(place_of_employment == agency_name))
View(certified_officers)
View(prior)
### CHECK MATCHES IN PRIOR TABLE ###
prior_join <- prior %>%
left_join(certified_directory_join, join_by(agency == place_of_employment))
View(prior_join)
### CHECK MATCHES IN PRIOR TABLE ###
prior_join <- prior %>%
anti_join(certified_directory_join, join_by(agency == place_of_employment))
View(prior_join)
### CHECK MATCHES IN PRIOR TABLE ###
prior_join <- prior %>%
left_join(certified_directory_join, join_by(agency == place_of_employment))
### CHECK MATCHES IN PRIOR TABLE ###
# Unique agencies in Prior
prior_agencies <- prior %>%
distinct(agency)
View(prior_agencies)
prior_join <- prior_agencies %>%
left_join(certified_directory_join, join_by(agency == place_of_employment))
View(prior_join)
prior_join <- prior_agencies %>%
anti_join(certified_directory_join, join_by(agency == place_of_employment))
### CHECK MATCHES IN PRESENT TABLE ###
# Unique agencies in Present
present_agencies <- present %>%
distinct(agency)
# 15 agencies that don't have a match and need to be manually crosswalked
present_join <- present_agencies %>%
anti_join(certified_directory_join, join_by(agency == place_of_employment))
View(present_join)
### CHECK MATCHES IN REINSTATED TABLE ###
# 43 unique agencies in Prior
reinstated_agencies <- reinstated %>%
distinct(agency)
View(reinstated)
View(reinstated_agencies)
# 15 agencies that don't have a match and need to be manually crosswalked
reinstated_join <- reinstated_agencies %>%
anti_join(certified_directory_join, join_by(agency == place_of_employment))
### EXPORT NONMATCHES TO CROSSWALK ###
write.csv(present_join, "../data/processed/unmatched_present.csv")
library(tidyverse)
library(here)
library(janitor)
library(readxl)
present_crosswalk <- read_csv(here("data", "manual", "present_crosswalk_corrections.csv"))
prior_crosswalk <- read_csv(here("data", "manual", "prior_crosswalk_corrections.csv"))
reinstated_crosswalk <- read_csv(here("data", "manual", "reinstated_crosswalk_corrections.csv"))
present <- read_csv(here("data", "processed", "present.csv"))
prior <- read_csv(here("data", "processed", "prior.csv"))
reinstated <- read_csv(here("data", "processed", "reinstated.csv"))
agency_directory <- read_excel(here("data", "raw", "Criminal_Justice_Agency_Directory.xlsx")) %>%
clean_names()
certified_officers <- read_excel(here("data", "raw", "Number_of_Certified_Officers_Per_Agency.xlsx")) %>%
clean_names()
View(present_crosswalk)
present <- present %>%
inner_join(present_crosswalk, join_by(agency))
prior <- read_csv(here("data", "processed", "prior.csv"))
View(present)
present <- read_csv(here("data", "processed", "present.csv"))
present_fixed <- present %>%
left_join(present_crosswalk, join_by(agency))
View(present_fixed)
present_fixed <- present %>%
left_join(present_crosswalk, join_by(agency)) %>%
mutate(agency_name = case_when(is.na(crosswalk_correction) ~ agency, .default = crosswalk_correction))
View(present_fixed)
present_fixed <- present %>%
left_join(present_crosswalk, join_by(agency)) %>%
mutate(agency_name = case_when(is.na(crosswalk_correction) ~ agency, .default = crosswalk_correction))
prior_fixed <- prior %>%
left_join(prior_crosswalk, join_by(agency)) %>%
mutate(agency_name = case_when(is.na(crosswalk_correction) ~ agency, .default = crosswalk_correction))
reinstated_fixed <- reinstated %>%
left_join(reinstated_crosswalk, join_by(agency)) %>%
mutate(agency_name = case_when(is.na(crosswalk_correction) ~ agency, .default = crosswalk_correction))
View(reinstated_fixed)
certified_directory_join <- certified_officers %>%
right_join(agency_directory, join_by(place_of_employment == agency_name))
View(certified_directory_join)
### WRITE TO FOLDER FOR ANALYSIS ###
write.csv(present_fixed, "../data/processed/clean_for_analysis/present.csv")
getwd()
### WRITE TO FOLDER FOR ANALYSIS ###
write.csv(present_fixed, "/data/processed/clean_for_analysis/present.csv")
### WRITE TO FOLDER FOR ANALYSIS ###
write.csv(present_fixed, "data/processed/clean_for_analysis/present.csv")
### WRITE TO FOLDER FOR ANALYSIS ###
write.csv(present_fixed, "data/processed/clean_for_analysis/present.csv")
write.csv(prior_fixed, "data/processed/clean_for_analysis/prior.csv")
write.csv(reinstated_fixed, "data/processed/clean_for_analysis/reinstated.csv")
write.csv(certified_directory_join, "data/processed/clean_for_analysis/certified_directory.csv")
